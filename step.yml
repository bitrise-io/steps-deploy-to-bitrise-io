title: "Deploy to Bitrise.io - Apps, Logs, Artifacts"
summary: |-
  Deploys build artifacts to make them available for the user on the build's **APPS & ARTIFACTS** tab. Sends test results to the Test Reports add-on.
description: |-
  The Step collects artifacts from previous Steps in the Workflow and places them in a specified deploy directory or compresses them into a single .zip file in the deploy directory. These artifacts are then available on the **APPS & ARTIFACTS** tab of any given build. For installable artifacts, such as IPAs or APKs, the Step can create a public install page that allows testers to install the app on their devices. You can also use the Step to notify users about the build.

  This Step is required in order to use the Test Reports add-on. It converts the test results to the right format and sends them to the add-on.

  ### Configuring the Step

  1. Set the value for the Deploy directory of file path. The default is the $BITRISE_DEPLOY_DIR environment variable which is exposed by the Bitrise CLI.
  2. Set the **Notify: User Roles** and the **Notify: Emails** inputs to configure notifications for the users. Note that the **Notify: Emails** input is only used if a public install page is created and you must use a Secret to set it.
  3. Optionally, you can create a zip file for all your build artifacts by setting the **Compress the artifacts into one file?** input to `true`. 

  Get a public install page that allows testers to install the app on their devices:

  1. Set the **Enable public page for the App?** input to `true`.
  2. Set the **Compress the artifacts into one file?** input to `false`. If all the contents of the deploy directory are compressed into a single zip file, there won't be a public install page.

  ### Troubleshooting

  If your users did not get notified via email, check the **Enable public page for the App?** input. If it is set to `false`, no email notifications will be sent.

  If you can't find the artifacts on the **APPS & ARTIFACTS** tab, check the **Deploy directory or file path** input. You can use [remote access](https://devcenter.bitrise.io/builds/remote-access/) to check if your artifacts are available at the specified location.

  ### Useful links
  - [Deployment on Bitrise](https://devcenter.bitrise.io/deploy/deployment-index/)

  ### Related Steps
  - [Deploy to Google Play](https://www.bitrise.io/integrations/steps/google-play-deploy)
  - [Deploy to iTunesConnect](https://www.bitrise.io/integrations/steps/deploy-to-itunesconnect-deliver)
website: https://github.com/bitrise-steplib/steps-deploy-to-bitrise-io
source_code_url: https://github.com/bitrise-steplib/steps-deploy-to-bitrise-io
support_url: https://github.com/bitrise-steplib/steps-deploy-to-bitrise-io/issues
host_os_tags:
  - "osx-10.10"
project_type_tags: []
type_tags:
  - deploy
is_requires_admin_user: false
is_always_run: true
is_skippable: false
run_if: .IsCI
toolkit:
  go:
    package_name: github.com/bitrise-steplib/steps-deploy-to-bitrise-io
inputs:
  - deploy_path: "$BITRISE_DEPLOY_DIR"
    opts:
      title: "Deploy directory or file path"
      description: |
        Specify the directory or file path which will be deployed.
        If the specified path is a directory, then every file
        in the specified directory will be deployed, sub-directories, however,
        won't be uploaded. To upload the directory's content
        recursively, you should use the *Compress* option
        which will compress the whole directory, with
        every sub-directory included.

        If you specify a file path, then only the specified
        file will be deployed.
      is_required: true
  - notify_user_groups: "everyone"
    opts:
      title: "Notify: User Roles"
      description: |
        Your App's user roles you want to notify. Separate the role names with commas.
        Possible role names:

        * none
        * testers
        * developers
        * admins
        * owner
        * everyone

        An example to notify your developers and testers:

        `testers, developers`

        If you want to notify everyone in the app's team, just specify `everyone`.

        If you don't want to notify anyone, set this to `none`.
  - notify_email_list:
    opts:
      title: "Notify: Emails"
      description: |
        Email addresses to notify. Separate them with commas.

        You can specify any email address, the recipients
        don't have to be in your team.
      is_sensitive: true
  - is_enable_public_page: "true"
    opts:
      title: "Enable public page for the App?"
      description: |
        If this option is enabled, a public install page
        will be available with a long and random URL which can be shared
        with others who are not registered on Bitrise.

        **If you disable this option, the `Notify Emails` option will
        be ignored and the `Notify User Roles` users will receive the build's
        URL instead of the public page's URL!**
      is_required: true
      is_expand: false
      value_options:
      - "true"
      - "false"
  - is_compress: "false"
    opts:
      title: Compress the artifacts into one file?
      summary: |-
        If this option is allowed, the artifacts
        found in the *Deploy directory* folder will be compressed
        into a single (ZIP) file.
      description: |-
        If this option is allowed, the artifacts
        found in the *Deploy directory* folder will be compressed
        into a single file.

        You can specify a custom name for the ZIP using the *zip_name*
        option - otherwise we're going to use the *Deploy directory* name.

        If this option is turned off, the artifacts
        found in the *Deploy directory* folder will be deployed
        separately.
      is_required: true
      is_expand: false
      value_options:
        - "true"
        - "false"
  - public_install_page_url_map_format: "{{range $index, $element := .}}{{if $index}}|{{end}}{{$element.File}}=>{{$element.URL}}{{end}}"
    opts:
      title: Format for the BITRISE_PUBLIC_INSTALL_PAGE_URL_MAP output
      summary: You can change the format of the BITRISE_PUBLIC_INSTALL_PAGE_URL_MAP output
      description: |-
        Specify the output pattern with golang template: [https://golang.org/pkg/text/template](https://golang.org/pkg/text/template)
      is_required: true
      is_expand: false                    
  - zip_name:
    opts:
      category: Debug
      title: Name of the compressed artifact (without .zip extension)
      summary: |-
        Specify a custom name for the compressed artifact. We're going to
        use the deploy directory name if you leave it blank.
      description: |-
        Specify a custom name for the compressed artifact. We're going to
        use the *Deploy directory* name if you leave it blank.

        This option only works if you selected *true* for *is_compress*.
  - build_url: "$BITRISE_BUILD_URL"
    opts:
      category: Debug
      title: "Bitrise Build URL"
      summary: |-
        Unique build URL of this build on Bitrise.io
      description: |-
        Unique build URL of this build on Bitrise.io
      is_required: true
      is_dont_change_value: true
  - build_api_token: "$BITRISE_BUILD_API_TOKEN"
    opts:
      category: Debug
      title: Bitrise Build API Token
      summary: |-
        The build's API Token for the build on Bitrise.io
      description: |-
        The build's API Token for the build on Bitrise.io
      is_required: true
      is_dont_change_value: true
      is_sensitive: true
  - addon_api_base_url: "https://vdt.bitrise.io/test"
    opts:
      title: "Test API's base URL"
      summary: The URL where test API is accessible.
      description: |
        The URL where test API is accessible.
      is_required: true
      is_dont_change_value: true
  - addon_api_token: $ADDON_VDTESTING_API_TOKEN
    opts: 
      title: "API Token"
      summary: The token required to authenticate with the API.
      description: |
        The token required to authenticate with the API.
      is_dont_change_value: true
      is_sensitive: true
  - generate_universal_apk_if_none: "false"
    opts:
      title: "Force generate universal APK for AABs"
      description: |
        When building an AAB artifact, check for a corresponding universal APK.
        If none is found, generate the corresponding locally signed universal
        APK for ease of debugging.
  - debug_mode: "false"
    opts: 
      category: Debug
      title: "Enable Debug Mode"
      summary: The step will print more verbose logs if enabled.
      description: The step will print more verbose logs if enabled.
      is_required: true
      value_options:
        - "false"
        - "true"
  - bundletool_version: "0.13.4"
    opts: 
      category: Debug
      title: "Bundletool version"
      summary: The version of bundletool you want to use.
      description: |-
        The version you specify will be installed.

        Versions are available here: https://github.com/google/bundletool/releases
      is_required: true
outputs:
  - BITRISE_PUBLIC_INSTALL_PAGE_URL:
    opts:
      title: Public Install Page URL
      description: |-
        Public Install Page's URL, if the
        *Enable public page for the App?* option was *enabled*.
  - BITRISE_PUBLIC_INSTALL_PAGE_URL_MAP:
    opts:
      title: Map of filenames and Public Install Page URLs
      description: |-
        Public Install Page URLs by the artifact's file path.
        Only set it if the *Enable public page for the App?* option was *enabled*.

        The format is `KEY1=>VALUE|KEY2=>VALUE`

        Examples:

        - $BITRISE_DEPLOY_DIR/ios_app.ipa=>https://ios_app/public/install/page
        - $BITRISE_DEPLOY_DIR/android_app.apk=>https://android_app/public/install/page|$BITRISE_DEPLOY_DIR/ios_app.ipa=>https://ios_app/public/install/page
